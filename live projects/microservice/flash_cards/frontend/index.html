<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Flashcards — Daily Vibes</title>
  <style>
    :root{
      --bg:#0f1724; --card:#0b1220; --muted:#94a3b8; --accent:#60a5fa;
      --success:#34d399; --danger:#fb7185; --glass: rgba(255,255,255,0.04);
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    *{box-sizing:border-box}
    html,body{height:100%; margin:0; background:linear-gradient(180deg,#080101 0%, #082032 100%); color:#e6eef8}
    .wrap{max-width:980px; margin:36px auto; padding:20px}
    header{display:flex;align-items:center;gap:18px;margin-bottom:20px}
    h1{margin:0;font-size:1.6rem;letter-spacing:-0.5px}
    p.lead{margin:0;color:var(--muted);font-size:0.95rem}
    .grid{display:grid;gap:16px}
    .two-col{grid-template-columns:1fr 340px}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); padding:16px;border-radius:12px;box-shadow:0 6px 18px rgba(2,6,23,0.6); border:1px solid rgba(255,255,255,0.03)}
    form{display:flex;flex-direction:column;gap:10px}
    input[type="text"], textarea{background:var(--card); border:1px solid rgba(255,255,255,0.04); padding:10px;border-radius:8px;color:inherit; outline:none; font-size:0.95rem}
    textarea{resize:vertical; min-height:72px}
    button{cursor:pointer;border:0;padding:10px 14px;border-radius:10px;font-weight:600}
    .btn-primary{background:linear-gradient(90deg,rgb(0, 29, 34),rgb(2, 51, 28)); color:#0fff9f;
      box-shadow: 0 4px 10px rgba(0, 255, 157, 0.904)}
    .btn-ghost{background:transparent;border:1px solid rgba(255,255,255,0.05); color:#aaaaaa;
    box-shadow: 0 4px 10px rgba(0, 255, 157, 0.904)}
    .btn-ghost:active{color:#0fff9f;transform: scale(0.95);}
    .list{display:grid;gap:12px}
    .card-row{display:flex;justify-content:space-between;align-items:flex-start;gap:12px}
    .meta{font-size:0.8rem;color:var(--muted)}
    .badge{padding:6px 8px;border-radius:8px;font-weight:600}
    .mood{background:var(--glass); color:var(--muted); font-weight:700}
    .action-row{display:flex;gap:8px}
    .btn-success{background:var(--success); color:#052018}
    .btn-danger{background:var(--danger); color:#3b0b0f}
    .small{font-size:0.9rem;padding:8px 10px;border-radius:8px}
    .center{display:flex;align-items:center;justify-content:center}
    .modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,0.5);display:flex;align-items:center;justify-content:center}
    .modal{width:420px; max-width:92%; background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); padding:18px;border-radius:12px;border:1px solid rgba(255,255,255,0.04)}
    footer{margin-top:18px;color:var(--muted);font-size:0.9rem}
    @media (max-width:880px){ .two-col{grid-template-columns:1fr} }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
      <h1 style="color:#32e99a;font-family:Monaco;">Flashcards</h1>
      </div>
    </header>

    <div class="grid two-col">
      <!-- LEFT: Cards list -->
      <div class="card">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
          <strong style="font-size:1rem">Your Cards</strong>
          <button id="refreshBtn" class="btn-ghost small">Refresh</button>
        </div>

        <div id="cardsList" class="list">
          <!-- cards inserted here -->
        </div>

        <div id="emptyHint" class="meta center" style="padding:18px">No cards yet — add one on the right.</div>
      </div>

      <!-- RIGHT: Add Card -->
      <div class="card">
        <strong style="display:block;margin-bottom:8px">Add a new card</strong>
        <form id="addForm">
          <input id="question" type="text" placeholder="Question (e.g. What is Python?)" required />
          <textarea id="answer" placeholder="Answer (e.g. A programming language)"></textarea>
          <div style="display:flex;gap:8px;justify-content:space-between;margin-top:6px">
            <button type="submit" align="left" class="btn-primary">Add Card</button>
            <button type="button" id="clearBtn" class="btn-ghost">Clear</button>
          </div>
        </form>
        <footer>
          <div style="margin-top:12px"><strong class="meta">API</strong></div>
          <div class="meta" id="apiInfo">CardService: <code id="cardUrl"></code><br>Scheduler: <code id="scheduleUrl"></code></div>
        </footer>
      </div>
    </div>
  </div>

  <!-- Modal -->
  <div id="modal" style="display:none"></div>

  <script>
  /*************** CONFIG - set your service base URLs here ***************/
  const CONFIG = {
    CARD_SERVICE_BASE: "https://crispy-palm-tree-xgpgpq55xgfv7wg-5000.app.github.dev/",      // change to your Codespace public URL if needed
    SCHEDULER_BASE: "https://crispy-palm-tree-xgpgpq55xgfv7wg-5001.app.github.dev/"         // change as needed
  };
  /***********************************************************************/

  // put API info in footer
  document.getElementById('cardUrl').innerText = CONFIG.CARD_SERVICE_BASE + "/cards";
  document.getElementById('scheduleUrl').innerText = CONFIG.SCHEDULER_BASE + "/schedule/{id}";

  // helper: HTTP utilities
  async function apiGet(path){
    const res = await fetch(path);
    if (!res.ok) throw new Error("Server error: " + res.status);
    return await res.json();
  }
  async function apiPost(path, body){
    const res = await fetch(path, {
      method: "POST",
      headers: {"Content-Type":"application/json"},
      body: JSON.stringify(body)
    });
    if (!res.ok) {
      const text = await res.text();
      throw new Error("Server error: " + res.status + " " + text);
    }
    return await res.json();
  }

  // UI elements
  const cardsList = document.getElementById('cardsList');
  const emptyHint = document.getElementById('emptyHint');
  const refreshBtn = document.getElementById('refreshBtn');
  const addForm = document.getElementById('addForm');
  const questionInput = document.getElementById('question');
  const answerInput = document.getElementById('answer');
  const modalRoot = document.getElementById('modal');

  // load cards from CardService
  async function loadCards(){
    cardsList.innerHTML = "";
    try {
      const url = CONFIG.CARD_SERVICE_BASE + "/cards";
      const data = await apiGet(url);
      if (!Array.isArray(data) || data.length === 0) {
        emptyHint.style.display = "flex";
        return;
      }
      emptyHint.style.display = "none";
      data.forEach(card => {
        const node = createCardNode(card);
        cardsList.appendChild(node);
      });
    } catch (err) {
      emptyHint.innerText = "Failed to load cards: " + err.message;
      emptyHint.style.display = "flex";
      console.error(err);
    }
  }

  function createCardNode(card){
    const wrapper = document.createElement('div');
    wrapper.className = "card-row";

    const left = document.createElement('div');
    left.style.flex = "1";
    const q = document.createElement('div');
    q.style.fontWeight = 700;
    q.innerText = card.question || card.message || "Untitled";
    const a = document.createElement('div');
    a.className = "meta";
    a.style.marginTop = "6px";
    a.innerText = card.answer ? ("Answer: " + card.answer) : "No answer";
    const meta = document.createElement('div');
    meta.className = "meta";
    meta.style.marginTop = "6px";
    meta.innerText = "ID: " + card.id;
    left.appendChild(q);
    left.appendChild(a);
    left.appendChild(meta);

    const right = document.createElement('div');
    right.className = "action-row";

    const reviewBtn = document.createElement('button');
    reviewBtn.className = "small btn-primary";
    reviewBtn.innerText = "Review";
    reviewBtn.onclick = () => openReviewModal(card);

    right.appendChild(reviewBtn);

    wrapper.appendChild(left);
    wrapper.appendChild(right);
    return wrapper;
  }

  // add card submit handler
  addForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    const q = questionInput.value.trim();
    const a = answerInput.value.trim();
    if (!q) return alert("Please enter a question.");
    try {
      const url = CONFIG.CARD_SERVICE_BASE + "/cards";
      const item = await apiPost(url, {question: q, answer: a});
      questionInput.value = "";
      answerInput.value = "";
      await loadCards();
    } catch (err) {
      alert("Failed to add card: " + err.message);
      console.error(err);
    }
  });

  document.getElementById('clearBtn').addEventListener('click', () => {
    questionInput.value = "";
    answerInput.value = "";
  });

  refreshBtn.addEventListener('click', loadCards);

  // Review modal
  function openReviewModal(card){
    modalRoot.innerHTML = "";
    modalRoot.style.display = "block";

    const backdrop = document.createElement('div');
    backdrop.className = "modal-backdrop";

    const box = document.createElement('div');
    box.className = "modal";

    const title = document.createElement('div');
    title.style.display = "flex";
    title.style.justifyContent = "space-between";
    title.style.alignItems = "center";
    title.innerHTML = `<strong>Review Card #${card.id}</strong><button id="closeX" class="btn-ghost small">Close</button>`;

    const question = document.createElement('div');
    question.style.marginTop = "12px";
    question.style.fontSize = "1.05rem";
    question.style.fontWeight = 700;
    question.innerText = card.question || card.message;

    const answer = document.createElement('div');
    answer.className = "meta";
    answer.style.marginTop = "10px";
    answer.innerText = "Answer: " + (card.answer || "--");

    const btnRow = document.createElement('div');
    btnRow.style.display = "flex";
    btnRow.style.justifyContent = "flex-end";
    btnRow.style.gap = "10px";
    btnRow.style.marginTop = "16px";

    const wrongBtn = document.createElement('button');
    wrongBtn.className = "btn-danger small";
    wrongBtn.innerText = "Wrong";
    wrongBtn.onclick = () => submitReview(card.id, false, box);

    const correctBtn = document.createElement('button');
    correctBtn.className = "btn-success small";
    correctBtn.innerText = "Correct";
    correctBtn.onclick = () => submitReview(card.id, true, box);

    btnRow.appendChild(wrongBtn);
    btnRow.appendChild(correctBtn);

    box.appendChild(title);
    box.appendChild(question);
    box.appendChild(answer);
    box.appendChild(btnRow);

    backdrop.appendChild(box);
    modalRoot.appendChild(backdrop);

    document.getElementById('closeX').onclick = closeModal;
  }

  function closeModal(){
    modalRoot.style.display = "none";
    modalRoot.innerHTML = "";
  }

  // call scheduler to mark review outcome
  async function submitReview(cardId, correct, boxEl){
    try {
      const url = CONFIG.SCHEDULER_BASE + "/schedule/" + encodeURIComponent(cardId);
      const data = await apiPost(url, {correct: correct});
      // show result inside modal (replace content)
      boxEl.innerHTML = `
        <div style="display:flex;justify-content:space-between;align-items:center">
          <strong>Result</strong>
          <button id="closeY" class="btn-ghost small">Close</button>
        </div>
        <div style="margin-top:12px"><strong>Next review:</strong></div>
        <div style="font-size:1.3rem;margin-top:8px">${data.nextReviewDate}</div>
        <div class="meta" style="margin-top:8px">Interval (days): ${data.intervalDays}</div>
      `;
      document.getElementById('closeY').onclick = closeModal;
    } catch (err) {
      alert("Scheduler error: " + err.message);
      console.error(err);
    }
  }

  // init
  loadCards();
  </script>
</body>
</html>
